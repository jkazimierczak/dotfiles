#!/usr/bin/env bash

export STARSHIP_CONFIG="${XDG_CONFIG_HOME}/starship/starship.toml"

_registerOhMyPosh() {
  if [[ ! $(command -v oh-my-posh) ]]; then
    echo "Installing Oh My Posh..."
    curl -s https://ohmyposh.dev/install.sh | bash -s >/dev/null 2>&1
  fi

  # Use shell specific variables instead of $SHELL
  # as $SHELL indicates the login shell, not the current shell
  if [ -n "$ZSH_VERSION" ]; then
    eval "$(oh-my-posh init zsh --config ~/.config/oh-my-posh/config.toml)"
  elif [ -n "$BASH_VERSION" ]; then
    eval "$(oh-my-posh init bash --config ~/.config/oh-my-posh/config.toml)"
  fi
}

_registerStarship() {
  if [[ ! $(command -v starship) ]]; then
    echo "Installing Starship..."
    curl -sS https://starship.rs/install.sh | sh -s -- -y >/dev/null 2>&1
  fi

  if [ -n "$ZSH_VERSION" ]; then
    eval "$(starship init zsh)"
  elif [ -n "$BASH_VERSION" ]; then
    eval "$(starship init bash)"
  fi
}

{{ if eq .prompt "starship" -}}
_registerStarship
{{ else if eq .prompt "oh-my-posh" -}}
_registerOhMyPosh
{{ end -}}
